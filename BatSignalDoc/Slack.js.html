<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Slack.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Slack.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Initiates the creation of a Slack post when someone sends up the bat signal.
 * 
 * This function is triggered by a "From spreadsheet - On form submit" Trigger.  
 * This means that every time someone shares an opportunity by filling 
 * out the Google Form, this function will be run automatically.
 * 
 * If you use e.namedValues, the form data will be returned in this format:
 * 
 * {  
 *   'Timestamp': ['6/7/2021 20:54:13'],  
 *   'Name': ['Kurt Kline'],  
 *   'Tags': ['Software Engineering; Farming; Space;'],  
 *    ...  
 * }
 * 
 * So you would need to access it like:  
 * e.namedValues["Timestamp"][0]  
 * e.namedValues["Name"][0]  
 * e.namedValues["Tags"][0]  
 * ...  
 * 
 * Since we are using e.values, it is returned as an Array:  
 * ['6/7/2021 20:54:13', 'Kurt Kline', 'Software Engineering; Farming; Space;', ...]
 * 
 * @return {undefined}
 * 
 */
function onFormSubmit(e) {
  var formData = e.values;
  var oppData = createSlackDigest([formData]);
  SlackLib.postToSlack(URLS.batWebHook, oppData);
}

/**
 * Parses tags.
 * 
 * @param {string} tags string of tags
 * @param {string} [delimiter=";"] delimiter to use for splitting tags 
 * @return {string}
 */
function parseTags(tags, delimiter=";") {
  var splitTags = tags.split(delimiter).map(item => item.trim());
  var filteredTags = splitTags.filter(function (el) {
    return el != "";
  });
  filteredTags = filteredTags.map(i => `\`${i}\``);
  return filteredTags
}

/**
 * Builds custom slack post sections.
 * 
 * @param {String[]} rowData row data
 * @return {object[]}
 */
function createSheetSpecificSlackSections(rowData) {
  var timestamp = rowData[0];
  var name = rowData[1];
  var tags = rowData[2];
  var description = rowData[3];
  var calendar = rowData[4];
  var email = rowData[5];
  var cleanTags = parseTags(tags);

  var titleSection = SlackLib.createSection(
    `${EMOJIS.slackBatSignal} ${name} has fired up the bat signal ${EMOJIS.slackBatSignal}`
    );
  var descriptionSection = SlackLib.createSection(`>_${description.trim()}_`);
  var tagSection = SlackLib.createSection(`*Tags*\n${cleanTags.join(" ")}`);
  var calendarSection = SlackLib.createSection(`*Calendar*\n${calendar}`);
  var emailSection = SlackLib.createSection(`*Email*\n${email}`);
  var footerSection = SlackLib.createSection(
    `Ready to send out your own ${EMOJIS.slackBatSignal}? Do it &lt;${URLS.batSignalForm}|here>.`
  );

  var sectionsToAdd = [
    titleSection,
    descriptionSection,
    tagSection,
    calendarSection,
    emailSection,
    SlackLib.createSectionDivider(),
    footerSection
  ];

  return sectionsToAdd;
}

/**
 * Creates slack digest.
 * 
 * Iterates through opportunity data and creates 
 * slack blocks which are used as a message template.
 * 
 * @param {Array[]} data Data from sheet or form
 * @return {object} 
 */
function createSlackDigest(data) {

  var slackMessageBlock = SlackLib.createSlackMessageBlock();

  for (var i = 0; i &lt; data.length; i++) {
    var sectionsToAdd = createSheetSpecificSlackSections(data[i]);
    slackMessageBlock = SlackLib.addSectionsToSlackMessageBlock(slackMessageBlock, sectionsToAdd);
  }

  return slackMessageBlock;
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#CONFIG">CONFIG</a></li><li><a href="global.html#createSheetSpecificSlackSections">createSheetSpecificSlackSections</a></li><li><a href="global.html#createSlackDigest">createSlackDigest</a></li><li><a href="global.html#onFormSubmit">onFormSubmit</a></li><li><a href="global.html#parseTags">parseTags</a></li><li><a href="global.html#URLS">URLS</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Thu Jun 17 2021 22:20:31 GMT+0100 (British Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
